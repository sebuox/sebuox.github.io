<script>
    function decodeMessage() {
        var img = document.getElementById('encoded_image');
        var canvas = document.createElement('canvas');
        var ctx = canvas.getContext('2d');

        canvas.width = img.width;
        canvas.height = img.height;
        ctx.drawImage(img, 0, 0);

        var imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
        var pixels = imageData.data;

        var message = '';
        var currentCharCode = 0;
        var bitIndex = 7;

        for (var i = 0; i < pixels.length; i += 4) {
            var pixel = pixels.slice(i, i + 4);

            // Retrieve the LSB of the red channel and assemble the characters
            var bit = pixel[0] & 1;
            currentCharCode |= bit << bitIndex;

            bitIndex--;

            if (bitIndex < 0) {
                // Check for null termination (ASCII code 0)
                if (currentCharCode === 0) {
                    break;
                }

                message += String.fromCharCode(currentCharCode);
                currentCharCode = 0;
                bitIndex = 7;
            }
        }

        var decodedMessage = document.getElementById('decoded_message');
        decodedMessage.innerText = message;
    }
</script>

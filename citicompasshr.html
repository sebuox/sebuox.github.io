<!DOCTYPE html>
<html>
<head>
  <meta name="viewport" content="initial-scale=1.0, user-scalable=no" />
  <style>
    html, body {
      height: 100%;
      margin: 0;
      padding: 0;
      font-family: Arial, sans-serif;
    }

    h1 {
      text-align: center;
      padding: 20px;
      background-color: #f1f1f1;
      margin: 0;
    }

    #search-container {
      text-align: center;
      margin-bottom: 20px;
    }

    #search-input {
      padding: 10px;
      font-size: 16px;
    }

    #search-button {
      padding: 10px 20px;
      background-color: #007bff;
      color: #ffffff;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      font-size: 16px;
    }

    #category-buttons {
      text-align: center;
      margin-bottom: 20px;
    }

    #category-buttons button {
      padding: 10px 20px;
      margin: 0 10px;
      background-color: transparent;
      color: #007bff;
      border: 2px solid #007bff;
      border-radius: 5px;
      cursor: pointer;
      font-size: 16px;
    }

    #search-results {
      max-height: 300px;
      overflow-y: scroll;
    }

    #search-results ul {
      list-style-type: none;
      padding: 0;
    }

    #search-results ul li {
      padding: 10px;
      background-color: #f1f1f1;
      margin-bottom: 10px;
      cursor: pointer;
    }

    #search-results ul li:hover {
      background-color: #e0e0e0;
    }

    #maps-container {
      display: none;
      height: calc(100% - 450px);
    }

    #map-container,
    #street-view-container {
      width: 100%;
      height: 100%;
    }

    #directions-panel {
      max-height: 200px;
      overflow-y: scroll;
    }

    #my-location-btn {
      padding: 10px 20px;
      background-color: #007bff;
      color: #ffffff;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      font-size: 16px;
      margin-bottom: 20px;
    }

    @media only screen and (max-width: 600px) {
      #search-input {
        width: 100%;
        margin-right: 0;
        margin-bottom: 10px;
      }

      #category-buttons {
        flex-direction: column;
        align-items: center;
      }

      #category-buttons button {
        margin: 5px 0;
      }

      #maps-container {
        flex-direction: column;
      }

      #map-container,
      #street-view-container {
        width: 100%;
      }
    }
  </style>
  <script>
    let map;
    let streetView;

    function initMap() {
      map = new google.maps.Map(document.getElementById("map-container"), {
        center: { lat: 0, lng: 0 },
        zoom: 13,
      });

      streetView = new google.maps.StreetViewPanorama(document.getElementById("street-view-container"));
      map.setStreetView(streetView);
    }

    function performSearch(query) {
      const service = new google.maps.places.PlacesService(map);
      const request = {
        location: map.getCenter(),
        radius: 5000,
        query: query,
      };

      service.textSearch(request, function (results, status) {
        if (status === google.maps.places.PlacesServiceStatus.OK) {
          showSearchResults(results);
        } else {
          clearSearchResults();
        }
      });
    }

    function showSearchResults(results) {
      const searchResults = document.getElementById("search-results");
      const ul = searchResults.querySelector("ul");
      ul.innerHTML = "";

      for (let i = 0; i < results.length; i++) {
        const result = results[i];
        const li = document.createElement("li");
        li.textContent = result.name;

        li.addEventListener("click", function () {
          showMaps(result);
        });

        ul.appendChild(li);
      }

      searchResults.style.display = "block";
      document.getElementById("maps-container").style.display = "none";
    }

    function clearSearchResults() {
      const searchResults = document.getElementById("search-results");
      searchResults.querySelector("ul").innerHTML = "";
      searchResults.style.display = "none";
    }

    function showMaps(result) {
      const latLng = new google.maps.LatLng(result.geometry.location.lat(), result.geometry.location.lng());
      map.setCenter(latLng);
      map.setZoom(15);
      streetView.setPosition(latLng);

      const directionsService = new google.maps.DirectionsService();
      const directionsRenderer = new google.maps.DirectionsRenderer({
        map: map,
        panel: document.getElementById("directions-panel"),
      });

      const origin = new google.maps.LatLng(map.getCenter().lat(), map.getCenter().lng());
      const destination = new google.maps.LatLng(result.geometry.location.lat(), result.geometry.location.lng());

      const request = {
        origin: origin,
        destination: destination,
        travelMode: google.maps.TravelMode.DRIVING,
      };

      directionsService.route(request, function (response, status) {
        if (status === google.maps.DirectionsStatus.OK) {
          directionsRenderer.setDirections(response);
        }
      });

      document.getElementById("search-results").style.display = "none";
      document.getElementById("maps-container").style.display = "block";

      window.scrollTo({
        top: document.body.scrollHeight,
        behavior: "smooth",
      });
    }

    function showMyLocation() {
      if (navigator.geolocation) {
        navigator.geolocation.getCurrentPosition(function (position) {
          const latLng = new google.maps.LatLng(position.coords.latitude, position.coords.longitude);
          map.setCenter(latLng);
          map.setZoom(15);
          streetView.setPosition(latLng);
        });
      } else {
        alert("Vaš preglednik ne podržava geolokaciju.");
      }
    }

    function searchOnClick() {
      const query = document.getElementById("search-input").value;
      performSearch(query);
    }

    document.addEventListener("DOMContentLoaded", function () {
      const searchButton = document.getElementById("search-button");
      searchButton.addEventListener("click", searchOnClick);

      const myLocationButton = document.getElementById("my-location-btn");
      myLocationButton.addEventListener("click", showMyLocation);
    });
  </script>
  <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAzTXkxuhorrftjjxil5A4yM0YECjQWH9A&libraries=places&callback=initMap" async defer></script>
</head>
<body>
  <h1>City Compass</h1>
  <div id="search-container">
    <input type="text" id="search-input" placeholder="Pretraži...">
    <button id="search-button">Pretraži</button>
  </div>
  <div id="category-buttons">
    <button onclick="performSearch('restorani')">Restorani</button>
    <button onclick="performSearch('bilježnice')">Bilježnice</button>
    <button onclick="performSearch('preporuke')">Preporuke</button>
    <button onclick="performSearch('muzeji')">Muzeji</button>
    <button onclick="performSearch('javni prijevoz')">Javni prijevoz</button>
    <button onclick="performSearch('ljekarne')">Ljekarne</button>
    <button onclick="performSearch('bankomati')">Bankomati</button>
  </div>
  <div id="search-results">
    <ul></ul>
  </div>
  <div id="maps-container">
    <div id="map-container"></div>
    <div id="street-view-container"></div>
  </div>
  <div id="directions-panel"></div>
  <button id="my-location-btn">Pokaži moju lokaciju</button>
  <script>
    const categoryButtons = document.getElementById("category-buttons");
    categoryButtons.style.background = "rgba(0, 0, 0, 0.5)";
    categoryButtons.style.color = "#ffffff";
    categoryButtons.style.fontFamily = "Arial, sans-serif";
    categoryButtons.style.padding = "10px";
  </script>
</body>
</html>
